{
  "consumes": [
    "application/json"
  ],
  "produces": [
    "application/json"
  ],
  "schemes": [
    "https"
  ],
  "swagger": "2.0",
  "info": {
    "description": "This is the secure API for the agreement bot.",
    "title": "Agreement Bot Secure API",
    "version": "0.0.1"
  },
  "host": "localhost",
  "paths": {
    "/deploycheck/deploycompatible": {
      "get": {
        "description": "This API does compatibility check for the given deployment policy (or a pattern), service definition, node policy and node user input. It does both policy compatibility check and user input compatibility check. If the result is compatible, it means that, when deployed, the node will form an agreement with the agbot and the service will be running on the node.",
        "consumes": [
          "application/json"
        ],
        "produces": [
          "application/json"
        ],
        "summary": "Check deployment compatibility.",
        "operationId": "deploy_compatible",
        "parameters": [
          {
            "type": "boolean",
            "description": "Return the compatibility check result for all the service versions referenced in the deployment policy or pattern.",
            "name": "checkAll",
            "in": "query"
          },
          {
            "type": "boolean",
            "description": "Show the input which was used to come up with the result.",
            "name": "long",
            "in": "query"
          },
          {
            "description": "The compCheck object as payload.",
            "name": "payload",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/CompCheck"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Ok",
            "schema": {
              "$ref": "#/definitions/CompCheckOutput"
            }
          },
          "400": {
            "description": "Failure - No input found",
            "schema": {
              "type": "string"
            }
          },
          "401": {
            "description": "Failure - Failed to authenticate",
            "schema": {
              "type": "string"
            }
          },
          "500": {
            "description": "Failure - Error",
            "schema": {
              "type": "string"
            }
          }
        }
      }
    },
    "/deploycheck/policycompatible": {
      "get": {
        "description": "This API does the policy compatibility check for the given deployment policy, node policy and service policy. The deployment policy and the service policy will be merged to check against the node policy. If the result is compatible, it means that, when deployed, the node will form an agreement with the agbot and the service will be running on the node.",
        "consumes": [
          "application/json"
        ],
        "produces": [
          "application/json"
        ],
        "summary": "Check the policy compatibility",
        "operationId": "deployCheckPolicyCompatible",
        "parameters": [
          {
            "type": "boolean",
            "description": "Return the compatibility check result for all the service versions referenced in the deployment policy or pattern.",
            "name": "checkAll",
            "in": "query"
          },
          {
            "type": "boolean",
            "description": "Show the input which was used to come up with the result.",
            "name": "long",
            "in": "query"
          },
          {
            "description": "The policy payload to check.",
            "name": "payload",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/PolicyCheck"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Ok",
            "schema": {
              "$ref": "#/definitions/CompCheckOutput"
            }
          },
          "400": {
            "description": "Failure - No input found",
            "schema": {
              "type": "string"
            }
          },
          "500": {
            "description": "Failure - Error",
            "schema": {
              "type": "string"
            }
          },
          "501": {
            "description": "Failure - Failed to authenticate",
            "schema": {
              "type": "string"
            }
          }
        }
      }
    },
    "/deploycheck/secretbindingcompatible": {
      "get": {
        "description": "This API does the secret binding compatibility check for the given deployment policy (or a pattern) and service definition. It checks if each secret defined in a serice has a binding associated in the given deployment policy (or pattern) and each bound secret exists in the secret manager. If the result is compatible, it means that, when deployed, the node will form an agreement with the agbot and the service will be running on the node.",
        "consumes": [
          "application/json"
        ],
        "produces": [
          "application/json"
        ],
        "summary": "Check the secret binding compatibility.",
        "operationId": "secretbinding_compatible",
        "parameters": [
          {
            "type": "boolean",
            "description": "Return the compatibility check result for all the service versions referenced in the deployment policy or pattern.",
            "name": "checkAll",
            "in": "query"
          },
          {
            "type": "boolean",
            "description": "Show the input which was used to come up with the result.",
            "name": "long",
            "in": "query"
          },
          {
            "description": "The payload of the secret binding.",
            "name": "payload",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/SecretBindingCheck"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Ok",
            "schema": {
              "$ref": "#/definitions/CompCheckOutput"
            }
          },
          "400": {
            "description": "Failure - No input found",
            "schema": {
              "type": "string"
            }
          },
          "401": {
            "description": "Failure - Failed to authenticate",
            "schema": {
              "type": "string"
            }
          },
          "500": {
            "description": "Failure - Error",
            "schema": {
              "type": "string"
            }
          }
        }
      }
    },
    "/deploycheck/userinputcompatible": {
      "get": {
        "description": "This API does the user input compatibility check for the given deployment policy (or a pattern), service definition and node user input. The user input values in the deployment policy and the node will be merged to check against the service uer input requirement defined in the service definition. If the result is compatible, it means that, when deployed, the node will form an agreement with the agbot and the service will be running on the node.",
        "consumes": [
          "application/json"
        ],
        "produces": [
          "application/json"
        ],
        "summary": "Check the user input compatibility.",
        "operationId": "userinputCompatible",
        "parameters": [
          {
            "type": "boolean",
            "description": "Return the compatibility check result for all the service versions referenced in the deployment policy or pattern.",
            "name": "checkAll",
            "in": "query"
          },
          {
            "type": "boolean",
            "description": "Show the input which was used to come up with the result.",
            "name": "long",
            "in": "query"
          },
          {
            "description": "The user input payload whose compatibility you want to check.",
            "name": "payload",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/UserInputCheck"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Ok",
            "schema": {
              "$ref": "#/definitions/CompCheckOutput"
            }
          },
          "400": {
            "description": "Failure - No input found",
            "schema": {
              "type": "string"
            }
          },
          "401": {
            "description": "Failure - Failed to authenticate",
            "schema": {
              "type": "string"
            }
          },
          "500": {
            "description": "Failure - Error",
            "schema": {
              "type": "string"
            }
          }
        }
      }
    },
    "/org/{org}/secrets/node/{node}/{secret}": {
      "get": {
        "consumes": [
          "application/json"
        ],
        "produces": [
          "application/json"
        ],
        "summary": "List given secret belonging to the org for a node.",
        "operationId": "nodeOrgSecretGet",
        "parameters": [
          {
            "type": "string",
            "description": "The organisation name the secret belongs to. Must be the same as the org the user node belongs to.",
            "name": "org",
            "in": "path",
            "required": true
          },
          {
            "type": "string",
            "description": "The node the secret is for.",
            "name": "node",
            "in": "path",
            "required": true
          },
          {
            "type": "string",
            "description": "The secret key (name).",
            "name": "secret",
            "in": "path",
            "required": true
          }
        ],
        "responses": {
          "200": {
            "description": "Ok",
            "schema": {
              "$ref": "#/definitions/SecretDetails"
            }
          },
          "401": {
            "description": "Unauthenticated user."
          },
          "403": {
            "description": "Secrets permission denied to user."
          },
          "404": {
            "description": "Secret does not exist."
          },
          "500": {
            "description": "Invalid vault response"
          },
          "503": {
            "description": "Secret provider unavailable"
          }
        }
      },
      "post": {
        "consumes": [
          "application/json"
        ],
        "produces": [
          "application/json"
        ],
        "summary": "Add a given secret belonging to the org for a node.",
        "operationId": "nodeOrgSecretPost",
        "parameters": [
          {
            "type": "string",
            "description": "The organisation name the secret belongs to. Must be the same as the org the user node belongs to.",
            "name": "org",
            "in": "path",
            "required": true
          },
          {
            "type": "string",
            "description": "The node the secret is for.",
            "name": "node",
            "in": "path",
            "required": true
          },
          {
            "type": "string",
            "description": "The secret key (name).",
            "name": "secret",
            "in": "path",
            "required": true
          },
          {
            "description": "The secret key and value.",
            "name": "secretDetails",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/SecretDetails"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Ok"
          },
          "401": {
            "description": "Unauthenticated user."
          },
          "403": {
            "description": "Secrets permission denied to user."
          },
          "404": {
            "description": "Secret does not exist."
          },
          "500": {
            "description": "Invalid vault response"
          },
          "503": {
            "description": "Secret provider unavailable"
          }
        }
      },
      "delete": {
        "consumes": [
          "application/json"
        ],
        "produces": [
          "application/json"
        ],
        "summary": "Delete a given secret belonging to the org for a node.",
        "operationId": "nodeOrgSecretDelete",
        "parameters": [
          {
            "type": "string",
            "description": "The organisation name the secret belongs to. Must be the same as the org the user node belongs to.",
            "name": "org",
            "in": "path",
            "required": true
          },
          {
            "type": "string",
            "description": "The node the secret is for.",
            "name": "node",
            "in": "path",
            "required": true
          },
          {
            "type": "string",
            "description": "The secret key (name).",
            "name": "secret",
            "in": "path",
            "required": true
          }
        ],
        "responses": {
          "200": {
            "description": "Ok"
          },
          "401": {
            "description": "Unauthenticated user."
          },
          "403": {
            "description": "Secrets permission denied to user."
          },
          "404": {
            "description": "Secret does not exist."
          },
          "500": {
            "description": "Invalid vault response"
          },
          "503": {
            "description": "Secret provider unavailable"
          }
        }
      }
    },
    "/org/{org}/secrets/user/{user}/node/{node}/{secret}": {
      "get": {
        "consumes": [
          "application/json"
        ],
        "produces": [
          "application/json"
        ],
        "summary": "List given secret belonging to the user for a node.",
        "operationId": "nodeUserSecretGet",
        "parameters": [
          {
            "type": "string",
            "description": "The organisation name the secret belongs to. Must be the same as the org the user node belongs to.",
            "name": "org",
            "in": "path",
            "required": true
          },
          {
            "type": "string",
            "description": "The user owning the secret.",
            "name": "user",
            "in": "path",
            "required": true
          },
          {
            "type": "string",
            "description": "The node the secret is for.",
            "name": "node",
            "in": "path",
            "required": true
          },
          {
            "type": "string",
            "description": "The secret key (name).",
            "name": "secret",
            "in": "path",
            "required": true
          }
        ],
        "responses": {
          "200": {
            "description": "Ok",
            "schema": {
              "$ref": "#/definitions/SecretDetails"
            }
          },
          "401": {
            "description": "Unauthenticated user."
          },
          "403": {
            "description": "Secrets permission denied to user."
          },
          "404": {
            "description": "Secret does not exist."
          },
          "500": {
            "description": "Invalid vault response"
          },
          "503": {
            "description": "Secret provider unavailable"
          }
        }
      },
      "post": {
        "consumes": [
          "application/json"
        ],
        "produces": [
          "application/json"
        ],
        "summary": "Add a given secret belonging to the user for a node.",
        "operationId": "userSecret",
        "parameters": [
          {
            "description": "The secret key and value.",
            "name": "secretDetails",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/SecretDetails"
            }
          },
          {
            "type": "string",
            "description": "The organisation name the secret belongs to. Must be the same as the org the user node belongs to.",
            "name": "org",
            "in": "path",
            "required": true
          },
          {
            "type": "string",
            "description": "The user owning the secret.",
            "name": "user",
            "in": "path",
            "required": true
          },
          {
            "type": "string",
            "description": "The node the secret is for.",
            "name": "node",
            "in": "path",
            "required": true
          },
          {
            "type": "string",
            "description": "The secret key (name).",
            "name": "secret",
            "in": "path",
            "required": true
          }
        ],
        "responses": {
          "200": {
            "description": "Ok"
          },
          "401": {
            "description": "Unauthenticated user."
          },
          "403": {
            "description": "Secrets permission denied to user."
          },
          "404": {
            "description": "Secret does not exist."
          },
          "500": {
            "description": "Invalid vault response"
          },
          "503": {
            "description": "Secret provider unavailable"
          }
        }
      }
    },
    "/org/{org}/secrets/user/{user}/{secret}": {
      "get": {
        "consumes": [
          "application/json"
        ],
        "produces": [
          "application/json"
        ],
        "summary": "List given secret belonging to the user.",
        "operationId": "userSecretGet",
        "parameters": [
          {
            "type": "string",
            "description": "The organisation name the secret belongs to.",
            "name": "org",
            "in": "path",
            "required": true
          },
          {
            "type": "string",
            "description": "The user owning the secret.",
            "name": "user",
            "in": "path",
            "required": true
          },
          {
            "type": "string",
            "description": "The secret key (name).",
            "name": "secret",
            "in": "path",
            "required": true
          }
        ],
        "responses": {
          "200": {
            "description": "Ok",
            "schema": {
              "$ref": "#/definitions/SecretDetails"
            }
          },
          "401": {
            "description": "Unauthenticated user."
          },
          "403": {
            "description": "Secrets permission denied to user."
          },
          "404": {
            "description": "Secret does not exist."
          },
          "500": {
            "description": "Invalid vault response"
          },
          "503": {
            "description": "Secret provider unavailable"
          }
        }
      },
      "post": {
        "consumes": [
          "application/json"
        ],
        "produces": [
          "application/json"
        ],
        "summary": "Add a given secret belonging to the user.",
        "operationId": "userSecretPost",
        "parameters": [
          {
            "description": "The secret key and value.",
            "name": "secretDetails",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/SecretDetails"
            }
          },
          {
            "type": "string",
            "description": "The organisation name the secret belongs to.",
            "name": "org",
            "in": "path",
            "required": true
          },
          {
            "type": "string",
            "description": "The user owning the secret.",
            "name": "user",
            "in": "path",
            "required": true
          },
          {
            "type": "string",
            "description": "The secret key (name).",
            "name": "secret",
            "in": "path",
            "required": true
          }
        ],
        "responses": {
          "200": {
            "description": "Ok"
          },
          "401": {
            "description": "Unauthenticated user."
          },
          "403": {
            "description": "Secrets permission denied to user."
          },
          "404": {
            "description": "Secret does not exist."
          },
          "500": {
            "description": "Invalid vault response"
          },
          "503": {
            "description": "Secret provider unavailable"
          }
        }
      },
      "delete": {
        "consumes": [
          "application/json"
        ],
        "produces": [
          "application/json"
        ],
        "summary": "Delete a given secret belonging to the user.",
        "operationId": "nodeUserSecretDelete",
        "parameters": [
          {
            "type": "string",
            "description": "The organisation name the secret belongs to. Must be the same as the org the user node belongs to.",
            "name": "org",
            "in": "path",
            "required": true
          },
          {
            "type": "string",
            "description": "The user owning the secret.",
            "name": "user",
            "in": "path",
            "required": true
          },
          {
            "type": "string",
            "description": "The secret key (name).",
            "name": "secret",
            "in": "path",
            "required": true
          }
        ],
        "responses": {
          "200": {
            "description": "Ok"
          },
          "401": {
            "description": "Unauthenticated user."
          },
          "403": {
            "description": "Secrets permission denied to user."
          },
          "404": {
            "description": "Secret does not exist."
          },
          "500": {
            "description": "Invalid vault response"
          },
          "503": {
            "description": "Secret provider unavailable"
          }
        }
      }
    },
    "/org/{org}/secrets/{secret}": {
      "get": {
        "consumes": [
          "application/json"
        ],
        "produces": [
          "application/json"
        ],
        "summary": "List given secret belonging to the org.",
        "operationId": "orgSecretGet",
        "parameters": [
          {
            "type": "string",
            "description": "The organisation name the secret belongs to.",
            "name": "org",
            "in": "path",
            "required": true
          },
          {
            "type": "string",
            "description": "The secret key (name).",
            "name": "secret",
            "in": "path",
            "required": true
          }
        ],
        "responses": {
          "200": {
            "description": "Ok",
            "schema": {
              "$ref": "#/definitions/SecretDetails"
            }
          },
          "401": {
            "description": "Unauthenticated user."
          },
          "403": {
            "description": "Secrets permission denied to user."
          },
          "404": {
            "description": "Secret does not exist."
          },
          "500": {
            "description": "Invalid vault response"
          },
          "503": {
            "description": "Secret provider unavailable"
          }
        }
      },
      "post": {
        "consumes": [
          "application/json"
        ],
        "produces": [
          "application/json"
        ],
        "summary": "Add a given secret belonging to the org.",
        "operationId": "orgSecretPut",
        "parameters": [
          {
            "description": "The secret key and value.",
            "name": "secretDetails",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/SecretDetails"
            }
          },
          {
            "type": "string",
            "description": "The organisation name the secret belongs to.",
            "name": "org",
            "in": "path",
            "required": true
          },
          {
            "type": "string",
            "description": "The secret key (name).",
            "name": "secret",
            "in": "path",
            "required": true
          }
        ],
        "responses": {
          "200": {
            "description": "Ok"
          },
          "401": {
            "description": "Unauthenticated user."
          },
          "403": {
            "description": "Secrets permission denied to user."
          },
          "404": {
            "description": "Secret does not exist."
          },
          "500": {
            "description": "Invalid vault response"
          },
          "503": {
            "description": "Secret provider unavailable"
          }
        }
      },
      "delete": {
        "consumes": [
          "application/json"
        ],
        "produces": [
          "application/json"
        ],
        "summary": "Delete a given secret belonging to the org.",
        "operationId": "orgSecretDelete",
        "parameters": [
          {
            "type": "string",
            "description": "The organisation name the secret belongs to.",
            "name": "org",
            "in": "path",
            "required": true
          },
          {
            "type": "string",
            "description": "The secret key (name).",
            "name": "secret",
            "in": "path",
            "required": true
          }
        ],
        "responses": {
          "200": {
            "description": "Ok"
          },
          "401": {
            "description": "Unauthenticated user."
          },
          "403": {
            "description": "Secrets permission denied to user."
          },
          "404": {
            "description": "Secret does not exist."
          },
          "500": {
            "description": "Invalid vault response"
          },
          "503": {
            "description": "Secret provider unavailable"
          }
        }
      }
    }
  },
  "definitions": {
    "CompCheck": {
      "title": "The input format for the compatibility check.",
      "x-go-package": "github.com/open-horizon/anax/compcheck"
    },
    "CompCheckOutput": {
      "title": "The output format for the compatibility check.",
      "x-go-package": "github.com/open-horizon/anax/compcheck"
    },
    "PolicyCheck": {
      "title": "The input format for the policy check.",
      "x-go-package": "github.com/open-horizon/anax/compcheck"
    },
    "SecretBindingCheck": {
      "title": "The input format for the secret binding check.",
      "x-go-package": "github.com/open-horizon/anax/compcheck"
    },
    "SecretDetails": {
      "title": "SecretDetails The key value pair of one secret.",
      "x-go-package": "github.com/open-horizon/anax/agreementbot/secrets"
    },
    "UserInputCheck": {
      "title": "The input format for the userinput check.",
      "x-go-package": "github.com/open-horizon/anax/compcheck"
    }
  }
}